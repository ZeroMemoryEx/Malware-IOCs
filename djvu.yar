import "pe"
import "math"

rule detect_djvu_variants
{
	meta:
		description = "Identifies STOP djvu family"
		author = "Anas Hadane"
  		reference = "https://github.com/ZeroMemoryEx/Malware-IOCs"
	strings:
		$a = { 5C 00 5A 00 65 00 7A 00 65 00 70 00 69 00 79 00 }
		$b = { 03 00 37 00 F9 9C 00 00 83 00 31 00 A0 9C 00 00 }
		$c = { 03 00 46 00 81 9E 00 00 03 00 48 00 01 9D 00 00 }
	condition:
		uint16(0) == 0x5a4d and 
		for any i in (0 .. pe.number_of_resources - 1) :
		(
			pe.resources[i].language  ==  1050 and
			( 
				math.entropy(pe.resources[i].offset, pe.resources[i].length) == 2.375 or 
				math.entropy(pe.resources[i].offset, pe.resources[i].length) == 2.967 
			)
		)
	and (pe.number_of_resources > 30 and pe.number_of_resources < 50) and filesize < 900KB and ( $a or $b or $c )
        
}
